!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.VueUploadComponent=t()}(this,function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=(function(){function e(e){this.value=e}function t(t){var r,i;function n(r,i){try{var a=t[r](i),s=a.value;s instanceof e?Promise.resolve(s.value).then(function(e){n("next",e)},function(e){n("throw",e)}):o(a.done?"return":"normal",a.value)}catch(e){o("throw",e)}}function o(e,t){switch(e){case"return":r.resolve({value:t,done:!0});break;case"throw":r.reject(t);break;default:r.resolve({value:t,done:!1})}(r=r.next)?n(r.key,r.arg):i=null}this._invoke=function(e,t){return new Promise(function(o,a){var s={key:e,arg:t,resolve:o,reject:a,next:null};i?i=i.next=s:(r=i=s,n(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("label",{class:e.className},[e._t("default"),e._v(" "),r("input-file")],2)},staticRenderFns:[],name:"file-upload",components:{InputFile:{render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("input",{attrs:{type:"file",name:e.$parent.name,id:e.$parent.inputId||e.$parent.name,accept:e.$parent.accept,webkitdirectory:e.$parent.directory&&e.$parent.features.directory,directory:e.$parent.directory&&e.$parent.features.directory,multiple:e.$parent.multiple&&e.$parent.features.html5},on:{change:e.change}})},staticRenderFns:[],methods:{change:function(e){this.$destroy(),this.$parent.addInputFile(e.target)}}}},props:{inputId:{type:String},name:{type:String,default:"file"},accept:{type:String},multiple:{type:Boolean},maximum:{type:Number,default:function(){return this.multiple?0:1}},addIndex:{type:[Boolean,Number]},directory:{type:Boolean},postAction:{type:String},headers:{type:Object,default:Object},data:{type:Object,default:Object},timeout:{type:Number,default:0},drop:{default:!1},dropDirectory:{type:Boolean,default:!0},size:{type:Number,default:0},extensions:{default:Array},value:{type:Array,default:Array},thread:{type:Number,default:1}},data:function(){return{files:this.value,features:{html5:!0,directory:!1,drag:!1},active:!1,dropActive:!1,uploading:0,destroy:!1}},mounted:function(){var e=document.createElement("input");e.type="file",e.multiple=!0,window.FormData&&e.files?("boolean"!=typeof e.webkitdirectory&&"boolean"!=typeof e.directory||(this.features.directory=!0),this.features.html5&&void 0!==e.ondrop&&(this.features.drop=!0)):this.features.html5=!1,this.maps={},this.$nextTick(function(){this.$parent&&this.$parent.$forceUpdate(),this.watchDrop(this.drop)})},beforeDestroy:function(){this.destroy=!0,this.active=!1},computed:{uploaded:function(){for(var e=void 0,t=0;t<this.files.length;t++)if((e=this.files[t]).fileObject&&!e.error&&!e.success)return!1;return!0},className:function(){return[]}},watch:{active:function(e){this.watchActive(e)},dropActive:function(){this.$parent&&this.$parent.$forceUpdate()},drop:function(e){this.watchDrop(e)},value:function(e){if(this.files!==e){this.files=e;var t=this.maps;this.maps={};for(var r=0;r<this.files.length;r++){var i=this.files[r];this.maps[i.id]=i}for(var n in this.maps){var o=this.maps[n],a=t[n];o!==a&&this.emitFile(o,a)}for(var s in t)this.maps[s]||this.emitFile(void 0,t[s])}}},methods:{clear:function(){if(this.files.length){var e=this.files;this.files=[],this.maps={},this.emitInput();for(var t=0;t<e.length;t++)this.emitFile(void 0,e[t])}return!0},get:function(t){return!!t&&("object"===(void 0===t?"undefined":e(t))?this.maps[t.id]||!1:this.maps[t]||!1)},add:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.addIndex,r=e,i=r instanceof Array;i||(r=[r]);for(var n=[],o=0;o<r.length;o++){var a=r[o];this.features.html5&&a instanceof Blob&&(a={file:a,size:a.size,name:a.webkitRelativePath||a.relativePath||a.name||"unknown",type:a.type});var s=!1;if(!1===a.fileObject||(a.fileObject?s=!0:"undefined"!=typeof Element&&a.el instanceof Element?s=!0:"undefined"!=typeof Blob&&a.file instanceof Blob&&(s=!0)),s&&((a=Object.assign({fileObject:!0,size:-1,name:"Filename",type:"",active:!1,error:"",success:!1,putAction:this.putAction,postAction:this.postAction,timeout:this.timeout},a,{response:{},progress:"0.00",speed:0})).data=Object.assign({},this.data,a.data?a.data:{}),a.headers=Object.assign({},this.headers,a.headers?a.headers:{})),a.id||(a.id=Math.random().toString(36).substr(2)),!this.emitFilter(a,void 0)){if(this.maximum>1&&n.length+this.files.length>=this.maximum)break;if(n.push(a),1===this.maximum)break}}if(!n.length)return!1;1===this.maximum&&this.clear();var u=void 0;!0===t||0===t?u=n.concat(this.files):t?(u=n.concat([])).splice(t,0,n):u=this.files.concat(n),this.files=u;for(var c=0;c<n.length;c++){var l=n[c];this.maps[l.id]=l}this.emitInput();for(var d=0;d<n.length;d++)this.emitFile(n[d],void 0);return i?n:n[0]},addInputFile:function(e){var t=[];if(e.files)for(var r=0;r<e.files.length;r++){var i=e.files[r];t.push({size:i.size,name:i.webkitRelativePath||i.relativePath||i.name,type:i.type,file:i,el:e})}else t.push({name:e.value.replace(/^.*?([^\/\\\r\n]+)$/,"$1"),el:e});return this.add(t)},addDataTransfer:function(e){var t=this,r=[];if(e.items&&e.items.length){for(var i=[],n=0;n<e.items.length;n++){var o=e.items[n];(o=o.getAsEntry?o.getAsEntry()||o.getAsFile():o.webkitGetAsEntry&&o.webkitGetAsEntry()||o.getAsFile())&&i.push(o)}return new Promise(function(e,n){!function n(o){var a=i[o];if(!a||t.maximum>0&&r.length>=t.maximum)return e(t.add(r));t.getEntry(a).then(function(e){r.push.apply(r,e),n(o+1)})}(0)})}if(e.files.length){for(var a=0;a<e.files.length&&(r.push(e.files[a]),!(this.maximum>0&&r.length>=this.maximum));a++);return Promise.resolve(this.add(r))}return Promise.resolve([])},getEntry:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Promise(function(i,n){if(e.isFile)e.file(function(e){i([{size:e.size,name:r+e.name,type:e.type,file:e}])});else if(e.isDirectory&&t.dropDirectory){var o=[],a=e.createReader();!function n(){a.readEntries(function(a){!function s(u){return!a[u]&&0===u||t.maximum>0&&o.length>=t.maximum?i(o):a[u]?void t.getEntry(a[u],r+e.name+"/").then(function(e){o.push.apply(o,e),s(u+1)}):n()}(0)})}()}else i([])})},remove:function(e){var t=this.get(e);if(t){if(this.emitFilter(void 0,t))return!1;var r=this.files.concat([]),i=r.indexOf(t);if(-1===i)return console.error("remove",t),!1;r.splice(i,1),this.files=r,delete this.maps[t.id],this.emitInput(),this.emitFile(void 0,t)}return t},update:function(e,t){var r=this.get(e);if(r){var i=Object.assign({},r,t);if(!r.fileObject||!r.active||i.active||i.error||i.success||(i.error="abort"),this.emitFilter(i,r))return!1;var n=this.files.concat([]),o=n.indexOf(r);return-1===o?(console.error("update",r),!1):(n.splice(o,1,i),this.files=n,delete this.maps[r.id],this.maps[i.id]=i,this.emitInput(),this.emitFile(i,r),i)}return!1},emitFilter:function(e,t){var r=!1;return this.$emit("input-filter",e,t,function(){return r=!0}),r},emitFile:function(e,t){this.$emit("input-file",e,t),!(e&&e.fileObject&&e.active)||t&&t.active?e&&e.fileObject&&e.active||!t||!t.fileObject||!t.active||this.uploading--:(this.uploading++,this.$nextTick(function(){var t=this;setTimeout(function(){t.upload(e).then(function(){e&&e.fileObject&&t.update(e,{active:!1,success:!e.error})}).catch(function(r){t.update(e,{active:!1,success:!1,error:r.code||r.error||r.message||r})})},parseInt(50*Math.random()+50,10))})),!this.active||Boolean(e)===Boolean(t)&&e.active===t.active||this.watchActive(!0)},emitInput:function(){this.$emit("input",this.files)},upload:function(t){var r=this.get(t);if(!r)return Promise.reject("not_exists");if(!r.fileObject)return Promise.reject("file_object");if(r.error)return Promise.reject(r.error);if(r.success)return Promise.resolve(r);var i=this.extensions;return i&&(i.length||void 0===i.length)&&("object"===(void 0===i?"undefined":e(i))&&i instanceof RegExp||("string"==typeof i&&(i=i.split(",").map(function(e){return e.trim()}).filter(function(e){return e})),i=new RegExp("\\.("+i.join("|").replace(/\./g,"\\.")+")$","i")),-1===r.name.search(i))?Promise.reject("extension"):this.size>0&&r.size>=0&&r.size>this.size?Promise.reject("size"):this.features.html5?this.uploadHtml5(r):this.uploadHtml4(r)},uploadHtml5:function(t){var r=new window.FormData,i=void 0;for(var n in t.data)(i=t.data[n])&&"object"===(void 0===i?"undefined":e(i))&&"function"!=typeof i.toString?i instanceof File?r.append(n,i,i.name):r.append(n,JSON.stringify(i)):null!==i&&void 0!==i&&r.append(n,i);r.append(this.name,t.file,t.file.filename||t.name);var o=new XMLHttpRequest;return o.open("POST",t.postAction),this.uploadXhr(o,t,r)},uploadXhr:function(e,t,r){var i=this,n=t,o=0,a=0;e.upload.onprogress=function(e){if(n=i.get(n),e.lengthComputable&&n&&n.fileObject&&n.active){var t=Math.round(Date.now()/1e3);t!==o&&(o=t,n=i.update(n,{progress:(e.loaded/e.total*100).toFixed(2),speed:e.loaded-a}),a=e.loaded)}};var s=setInterval(function(){if(!(n=i.get(n))||!n.fileObject||n.success||n.error||!n.active){s&&(clearInterval(s),s=!1);try{e.abort(),e.timeout=1}catch(e){}}},100);return new Promise(function(t,o){var a=void 0,u=function(r){if(!a){if(a=!0,s&&(clearInterval(s),s=!1),!(n=i.get(n)))return o("not_exists");if(!n.fileObject)return o("file_object");if(n.error)return o(n.error);if(!n.active)return o("abort");if(n.success)return t(n);var u={};switch(r.type){case"timeout":case"abort":u.error=r.type;break;case"error":e.status?e.status>=500?u.error="server":e.status>=400&&(u.error="denied"):u.error="network";break;default:e.status>=500?u.error="server":e.status>=400?u.error="denied":u.progress="100.00"}if(e.responseText){var c=e.getResponseHeader("Content-Type");c&&-1!==c.indexOf("/json")?u.response=JSON.parse(e.responseText):u.response=e.responseText}return(n=i.update(n,u)).error?o(n.error):t(n)}};for(var c in e.onload=u,e.onerror=u,e.onabort=u,e.ontimeout=u,n.timeout&&(e.timeout=n.timeout),n.headers)e.setRequestHeader(c,n.headers[c]);n=i.update(n,{xhr:e}),e.send(r)})},uploadHtml4:function(t){var r=this,i=t,n=function(e){27===e.keyCode&&e.preventDefault()},o=document.createElement("iframe");o.id="upload-iframe-"+i.id,o.name="upload-iframe-"+i.id,o.src="about:blank",o.setAttribute("style","width:1px;height:1px;top:-999em;position:absolute; margin-top:-999em;");var a=document.createElement("form");a.action=i.postAction,a.name="upload-form-"+i.id,a.setAttribute("method","POST"),a.setAttribute("target","upload-iframe-"+i.id),a.setAttribute("enctype","multipart/form-data");var s=void 0,u=void 0;for(var c in i.data)(s=i.data[c])&&"object"===(void 0===s?"undefined":e(s))&&"function"!=typeof s.toString&&(s=JSON.stringify(s)),null!==s&&void 0!==s&&((u=document.createElement("input")).type="hidden",u.name=c,u.value=s,a.appendChild(u));a.appendChild(i.el),document.body.appendChild(o).appendChild(a);return new Promise(function(e,t){setTimeout(function(){if(!(i=r.update(i,{iframe:o})))return t("not_exists");var s=setInterval(function(){(i=r.get(i))&&i.fileObject&&!i.success&&!i.error&&i.active||(s&&(clearInterval(s),s=!1),o.onabort({type:i?"abort":"not_exists"}))},100),u=void 0,c=function(a){if(!u){if(u=!0,s&&(clearInterval(s),s=!1),document.body.removeEventListener("keydown",n),!(i=r.get(i)))return t("not_exists");if(!i.fileObject)return t("file_object");if(i.error)return t(i.error);if(!i.active)return t("abort");if(i.success)return e(i);var c=function(){var e=void 0;try{o.contentWindow&&(e=o.contentWindow.document)}catch(e){}if(!e)try{e=o.contentDocument?o.contentDocument:o.document}catch(t){e=o.document}return e&&e.body?e.body.innerHTML:null}(),l={};switch(a.type){case"abort":l.error="abort";break;case"error":i.error?l.error=i.error:l.error=null===c?"network":"denied";break;default:i.error?l.error=i.error:null===l?l.error="network":l.progress="100.00"}if(null!==c){if(c&&"{"===c.substr(0,1)&&"}"===c.substr(c.length-1,1))try{c=JSON.parse(c)}catch(e){}l.response=c}return(i=r.update(i,l)).error?t(i.error):e(i)}};o.onload=c,o.onerror=c,o.onabort=c,document.body.addEventListener("keydown",n),a.submit()},50)}).then(function(e){return o.parentNode&&o.parentNode.removeChild(o),e}).catch(function(e){return o.parentNode&&o.parentNode.removeChild(o),e})},watchActive:function(e){for(var t=void 0,r=0;t=this.files[r];)if(r++,t.fileObject)if(e&&!this.destroy){if(this.uploading>=this.thread||this.uploading&&!this.features.html5)break;t.active||t.error||t.success||this.update(t,{active:!0})}else t.active&&this.update(t,{active:!1});else;0===this.uploading&&(this.active=!1)},watchDrop:function(e){var t=e;if(this.features.drop){if(this.dropElement)try{document.removeEventListener("dragenter",this.onDragenter,!1),document.removeEventListener("dragleave",this.onDragleave,!1),document.removeEventListener("drop",this.onDocumentDrop,!1),this.dropElement.removeEventListener("dragover",this.onDragover,!1),this.dropElement.removeEventListener("drop",this.onDrop,!1)}catch(e){}t?"string"==typeof t?t=document.querySelector(t)||this.$root.$el.querySelector(t):!0===t&&(t=this.$parent.$el):t=!1,this.dropElement=t,this.dropElement&&(document.addEventListener("dragenter",this.onDragenter,!1),document.addEventListener("dragleave",this.onDragleave,!1),document.addEventListener("drop",this.onDocumentDrop,!1),this.dropElement.addEventListener("dragover",this.onDragover,!1),this.dropElement.addEventListener("drop",this.onDrop,!1))}},onDragenter:function(e){e.preventDefault(),this.dropActive||(this.dropActive=!0)},onDragleave:function(e){e.preventDefault(),("HTML"===e.target.nodeName||0===e.screenX&&0===e.screenY&&!e.fromElement&&e.offsetX<=0)&&(this.dropActive=!1)},onDragover:function(e){e.preventDefault()},onDocumentDrop:function(){this.dropActive=!1},onDrop:function(e){e.preventDefault(),this.addDataTransfer(e.dataTransfer)}}}),r=Object.freeze({default:t});return r&&t||r});
//# sourceMappingURL=vue-upload-component.min.js.map
